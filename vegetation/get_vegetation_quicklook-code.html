<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:02:16 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_vegetation_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_vegetation_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      GET_VEGETATION_QUICKLOOK       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      OUTPUTS A RGB/GRAYSCALE VEGETATION QUICKLOOK WITH ROI OVERLAY IF REQUESTED</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = GET_VEGETATION_QUICKLOOK(FILENAME)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      FILENAME - A SCALAR CONTAINING THE FILENAME OF THE PRODUCT FOR QUICKLOOK GENERATION </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*     RGB          -  PROGRAM GENERATES AN RGB COLOUR QUICKLOOK (DEFAULT IS GRAYSCALE)</span>
<span class="comments">;*     ROI          -  OVERLAY COORDINATES OF AN ROI IN RED (REQUIRES ICOORDS)</span>
<span class="comments">;*     ICOORDS      -  A 4-ELEMENT ARRAY OF ROI GEOLOCATION (N,S,E,W) </span>
<span class="comments">;*     QL_QUALITY   -  QUALITY OF JPEG GENERATED (100 = MAX, 0 = LOWEST)</span>
<span class="comments">;*     ENDIAN_SIZE  -  MACHINE ENDIAN SIZE (0: LITTLE, 1: BIG)</span>
<span class="comments">;*     VERBOSE      -  PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*     STATUS       - 1: NOMINAL, (-1) OR 0: ERROR</span>
<span class="comments">;*     JPESG ARE AUTOMATICALLY SAVED IN FILENAME FOLDER    </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*     NONE </span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      17 DEC 2010 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      01 DEC 2010 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1: COMPILATION SUCCESSFUL,</span>
<span class="comments">;*                                RGB,ROI,ICOORDS AND QL_QUALITY KEYWORDS TESTED </span>
<span class="comments">;*                                SUCCESSFULLY USING UYUNI COORDINATES</span>
<span class="comments">;*      06 JAN 2011 - C KENT    - LINUX 64-BIT MACHINE IDL 8.0: COMPILATION SUCCESSFUL, </span>
<span class="comments">;*                                NO APPARENT DIFFERENCES WHEN COMPARED TO WINDOWS MACHINE</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION GET_VEGETATION_QUICKLOOK,FILENAME,RGB=RGB,ROI=ROI,ICOORDS=ICOORDS,QL_QUALITY=QL_QUALITY,VERBOSE=VERBOSE

<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK FILENAME AND IN_BAND ARE NOMINAL</span>

  IF FILENAME EQ '' THEN BEGIN
    PRINT, 'VEGETATION L1B QUICKLOOK: ERROR, INPUT FILENAME INCORRECT'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; SET JPEG QUALITY IF NOT PROVIDED</span>

  IF N_ELEMENTS(QL_QUALITY) EQ 0 THEN QL_QUALITY = 90
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: JPEG QUALITY = ',QL_QUALITY
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK KEYWORD COMBINATIONS</span>

  IF KEYWORD_SET(ROI) AND N_ELEMENTS(ICOORDS) LT 4 THEN BEGIN
    PRINT,'VEGETATION L1B QUICKLOOK: ERROR, ROI KEYWORD IS SET BUT COORDINATES INCORRECT'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; DERIVE THE OUTPUT JPEG FILENAME</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: COMPUTING OUTPUT FILENAME'
  QL_VEGETATION_JPG = string(STRMID(FILENAME,0,STRLEN(FILENAME)-7)+'QUICKLOOK.jpg')
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; GET VEGETATION L1B RADIANCE DATA AND DERIVEQUICKLOOK IMAGE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: RETRIEVING REFLECTANCE DATA'
  L1B_DATA = GET_VEGETATION_L1B_REFLECTANCE(FILENAME)
  
  IF KEYWORD_SET(RGB) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: RGB JPEG SELECTED'

    QL_DATAR = L1B_DATA[*,*,2]
    QL_DATAG = L1B_DATA[*,*,1]
    QL_DATAB = L1B_DATA[*,*,0]
    
  ENDIF ELSE BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: GRAYSCALE SELECTED'
    QL_DATAR  = L1B_DATA[*,*,2]
  ENDELSE
  
  IF QL_DATAr[0] EQ -1 THEN BEGIN
    PRINT,'VEGETATION L1B QUICKLOOK: ERROR, PROBLEM ENCOUNTERED DURING L1B RADIANCE RETRIEVAL, CHECK PRODUCTS IS A VEGETATION L1B PRODUCT'
    RETURN,-1
  ENDIF

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: GET PRODUCT DIMENSIONS AND DEFINE IMAGE ARRAY'
  QL_DIMS_NEW  = SIZE(QL_DATAR)
  QL_IMAGE = BYTARR(3,QL_DIMS_NEW[1],QL_DIMS_NEW[2])
  
<span class="comments">;-----------------------------------------------</span>
<span class="comments">; POPULATE THE QUICKLOOK IMAGE ARRAY  </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: ADD RADIANCE DATA TO IMAGE ARRAY CHANNELS'
  TOP_REF = 250
  IF KEYWORD_SET(RGB) THEN BEGIN 
   
    TEMP_MAX = MAX([MAX(QL_DATAR),MAX(QL_DATAG),MAX(QL_DATAB)])
    TEMP_MAX = 0.85
    QL_IMAGE[0,*,*]=BYTSCL(QL_DATAR,MAX=TEMP_MAX,TOP=TOP_REF)
    QL_IMAGE[1,*,*]=BYTSCL(QL_DATAG,MAX=TEMP_MAX,TOP=TOP_REF)
    QL_IMAGE[2,*,*]=BYTSCL(QL_DATAB,MAX=TEMP_MAX,TOP=TOP_REF)

<span class="comments">;----------------------------------------------</span>
<span class="comments">; RELEASE MEMORY FOR GREEN AND BLUE CHANNELS</span>
    
    QL_DATAG = 0
    QL_DATAB = 0
    
  ENDIF ELSE BEGIN
  
    TEMP_MAX = 1.0
    QL_IMAGE[0,*,*]=BYTSCL(QL_DATAR,TOP=TOP_REF,MAX=TEMP_MAX)
    QL_IMAGE[1,*,*]=BYTSCL(QL_DATAR,TOP=TOP_REF,MAX=TEMP_MAX)
    QL_IMAGE[2,*,*]=BYTSCL(QL_DATAR,TOP=TOP_REF,MAX=TEMP_MAX)
  ENDELSE

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; GET LAT/LON DATA FOR ROI PIXEL INDEX IF REQUESTED</span>

  IF KEYWORD_SET(ROI) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: OVERLAY OF ROI SELECTED'
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: RETRIEVING PRODUCT GEOLOCATION'
    
<span class="comments">;---------------------------------------------------</span>
<span class="comments">; USE GEOLOCATION DATA</span>

    QL_GEO = GET_VEGETATION_LAT_LON(FILENAME)

    QL_GEO_LAT = QL_GEO.LAT
    QL_GEO_LON = QL_GEO.LON

    QL_ROI_IDX = WHERE($
          QL_GEO_LAT LT ICOORDS[0] AND $
          QL_GEO_LAT GT ICOORDS[1] AND $
          QL_GEO_LON LT ICOORDS[2] AND $
          QL_GEO_LON GT ICOORDS[3] )

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; CONVERT ROI PIXELS TO A LIGHT RED OVERLAY</span>

    IF QL_ROI_IDX[0] GT -1 THEN BEGIN
          IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: MODIFYING RED CHANNEL FOR ROI OVERLAY'
          QL_DATAR = QL_IMAGE[0,*,*]
          QL_DATAR[QL_ROI_IDX]=250
          QL_IMAGE[0,*,*] = QL_DATAR
          <span class="comments">;  QL_DATAR = QL_IMAGE[0,*,*]</span>
          <span class="comments">;  QL_DATAG = QL_IMAGE[1,*,*]</span>
          <span class="comments">;  QL_DATAB = QL_IMAGE[2,*,*]</span>
          
          <span class="comments">; QL_DATAR[QL_ROI_IDX]=250</span>
          <span class="comments">;  QL_DATAG[QL_ROI_IDX]=50</span>
          <span class="comments">;  QL_DATAB[QL_ROI_IDX]=50</span>
          <span class="comments">;  QL_IMAGE[0,*,*] = QL_DATAR</span>
          <span class="comments">;  QL_IMAGE[1,*,*] = QL_DATAG</span>
          <span class="comments">;  QL_IMAGE[2,*,*] = QL_DATAB</span>
          
    ENDIF
  ENDIF

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; OUTPUT QUICKLOOK AS JPEG</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VEGETATION L1B QUICKLOOK: WRITING IMAGE TO JPEG'
  WRITE_JPEG ,QL_VEGETATION_JPG,QL_IMAGE,TRUE=1,/ORDER
  
<span class="comments">;---------------------------------------------------</span>
<span class="comments">; RETURN A POSITIVE VALUE INDICATING QL GENERATION OK</span>

  RETURN, 1

END
</code>
    </div>
  </body>
</html>