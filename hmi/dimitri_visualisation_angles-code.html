<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:52 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_visualisation_angles.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_visualisation_angles.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_VISUALISATION_ANGLES     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM AUTOMATICALLY SERACHES AND RETRIEVES THE DOUBLET ANGLE </span>
<span class="comments">;*      INFORMATION OUTPUT BY DMIITRI GIVEN AN OUTPUT FOLDER AND REFERENCE </span>
<span class="comments">;*      SENSOR CONFIGURATION.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_VISUALISATION_ANGLES(ED_FOLDER,VA_REGION,REF_SENSOR,REF_PROC_VER)      </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      ED_FOLDER     - A STRING OF THE FULL PATH FOR THE DOUBLET_EXTRACTION OUTPUT FOLDER</span>
<span class="comments">;*      VA_REGION     - A STRING OF THE DIMITRI VALIDATION SITE REQUESTED</span>
<span class="comments">;*      REF_SENSOR    - A STRING OF THE REFERENCE SENSOR UTILISED FOR PROCESSING</span>
<span class="comments">;*      REF_PROC_VER  - A STRING OF THE REFERENCE SENSOR'S PROCESSING VERSION </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      A STRUCTURE WITH THE FOLLOWING TAGS:</span>
<span class="comments">;*      ERROR             - THE ERROR STATUS CODE, 0 = NOMINAL, 1 OR -1 = ERROR</span>
<span class="comments">;*      DATA              - AN ARRAY CONTAINING ALL GEOMETRY ANGLES [VZA,VAA,SZA,SAA]</span>
<span class="comments">;*      NUM_SENS_CONFIGS  - NUMBER OF SENSOR CONFIGURATIONS FOUND</span>
<span class="comments">;*      SENSOR_CONFIGS    - A STRING OF THE SENSOR CONFIGURATIONS FOUND</span>
<span class="comments">;*      SENS_CONFIG_ABLE  - AN INTEGER ARRAY DESCRIBING IF DATA IS AVAILABLE FOR A</span>
<span class="comments">;*                          CERTAIN SENSOR CONFIGURATION</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      25 AUG 2011 - C KENT    - REMOVED ANGULAR CORRECTION AS NOW IMPLEMENTED DURING INGESTION</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1/IDL 8.0: NOMINAL </span>
<span class="comments">;*      14 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                                COMPILATION AND OPERATION</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_VISUALISATION_ANGLES,ED_FOLDER,VA_REGION,REF_SENSOR,REF_PROC_VER,VERBOSE=VERBOSE

<span class="comments">;--------------------------------</span>
<span class="comments">; FIND ALL CORRESPONDING DOUBLET </span>
<span class="comments">; EXTRACTION FILES </span>
  
  REF_STR = 'ED_'+VA_REGION+'_'+REF_SENSOR+'_'+REF_PROC_VER+'*.dat'
  CAL_STR = 'ED_'+VA_REGION+'_*'+REF_SENSOR+'_'+REF_PROC_VER+'.dat'

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: SEARCHING FOR DOUBLET DATA'
  REF_FILES = FILE_SEARCH(ED_FOLDER,REF_STR)
  CAL_FILES = FILE_SEARCH(ED_FOLDER,CAL_STR)
  
  IF STRCMP(REF_FILES[0],'') EQ 1 OR $
     STRCMP(CAL_FILES[0],'') EQ 1 OR $
     (N_ELEMENTS(REF_FILES) NE N_ELEMENTS(CAL_FILES)) THEN BEGIN
    PRINT, 'DIMITRI_VISU_ANGL: ERROR, NO DOUBLET DATA FOUND'
    RETURN,{ERROR:1}
  ENDIF

<span class="comments">;--------------------------------</span>
<span class="comments">; GET THE NUMBER OF REFERENCE/CALIBRATION </span>
<span class="comments">; FILES AVAILABLE     </span>
  
  NUM_REF_CONFIGS   = N_ELEMENTS(REF_FILES)
  NUM_CAL_CONFIGS   = N_ELEMENTS(CAL_FILES)
  NUM_SENS_CONFIGS  = 1+NUM_CAL_CONFIGS

<span class="comments">;--------------------------------</span>
<span class="comments">; START LIST OF ALL SENSOR AND </span>
<span class="comments">; PROCESSING VERSION CONFIGURATIONS, </span>
<span class="comments">; AND REFERENCE SENSOR DATES AND </span>
<span class="comments">; REFLECTANCE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: DEFINING SENSOR CONFIGURAITON ARRAY'
  SENSOR_CONFIGS  = STRING(REF_SENSOR+'_'+REF_PROC_VER)
  SENS_CONFIG_ABLE= MAKE_ARRAY(N_ELEMENTS(NUM_SENS_CONFIGS),/INTEGER,VALUE=0)
  SENS_CONFIG_ABLE[0] = 1
  TMP_REF_DATE    = DOUBLE(0.0)
  TMP_REF_VZA     = TMP_REF_DATE & TMP_REF_VAA = TMP_REF_DATE
  TMP_REF_SZA     = TMP_REF_DATE & TMP_REF_SAA = TMP_REF_DATE

<span class="comments">;-------------------------------- </span>
<span class="comments">; CONCATENATE DATE AND REFLECTANCE </span>
<span class="comments">; INFO FOR REFERENCE SENSOR</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: CONCATENATING REFERENCE SENSOR INFORMATION'  
  NUM_NON_REFS = 5+12
  FOR ITEMP=0,NUM_REF_CONFIGS-1 DO BEGIN
    RESTORE,REF_FILES[ITEMP]
    TEMP_ELEMENTS = N_ELEMENTS(ED_SENSOR1_SENSOR2[0,*])
    TMP_REF_DATE  = [TMP_REF_DATE,REFORM(DOUBLE(ED_SENSOR1_SENSOR2[0,*]),TEMP_ELEMENTS)]
    TMP_REF_VZA   = [TMP_REF_VZA, REFORM(DOUBLE(ED_SENSOR1_SENSOR2[1,*]),TEMP_ELEMENTS)]
    TMP_REF_VAA   = [TMP_REF_VAA, REFORM(DOUBLE(ED_SENSOR1_SENSOR2[2,*]),TEMP_ELEMENTS)]
    TMP_REF_SZA   = [TMP_REF_SZA, REFORM(DOUBLE(ED_SENSOR1_SENSOR2[3,*]),TEMP_ELEMENTS)]
    TMP_REF_SAA   = [TMP_REF_SAA, REFORM(DOUBLE(ED_SENSOR1_SENSOR2[4,*]),TEMP_ELEMENTS)]
  ENDFOR

<span class="comments">;--------------------------------</span>
<span class="comments">; SORT VALUES INTO ASCENDING TIME</span>

  TEMP = SORT(TMP_REF_DATE)
  TMP_REF_DATE  = TMP_REF_DATE[TEMP[1:N_ELEMENTS(TEMP)-1]]
  TMP_REF_VZA   = TMP_REF_VZA [TEMP[1:N_ELEMENTS(TEMP)-1]]
  TMP_REF_VAA   = TMP_REF_VAA [TEMP[1:N_ELEMENTS(TEMP)-1]]
  TMP_REF_SZA   = TMP_REF_SZA [TEMP[1:N_ELEMENTS(TEMP)-1]]
  TMP_REF_SAA   = TMP_REF_SAA [TEMP[1:N_ELEMENTS(TEMP)-1]]
  NUM_REF_DATE  = N_ELEMENTS(TMP_REF_DATE)

<span class="comments">;--------------------------------  </span>
<span class="comments">; CREATE AN ARRAY TO HOLD ALL TIME </span>
<span class="comments">; AND ANGULAR DATA FOR EACH </span>
<span class="comments">; SENSOR CONFIGURATION FOUND</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: DEFINING ARRAY TO HOLD ALL ANGLE DATA'
  ANGL_DATA         = MAKE_ARRAY(NUM_REF_DATE,NUM_SENS_CONFIGS,5,/DOUBLE)
  ANGL_DATA[*,0,0]  = TMP_REF_DATE
  ANGL_DATA[*,0,1]  = TMP_REF_VZA   
  ANGL_DATA[*,0,2]  = TMP_REF_VAA
  ANGL_DATA[*,0,3]  = TMP_REF_SZA
  ANGL_DATA[*,0,4]  = TMP_REF_SAA
 
<span class="comments">;-------------------------------- </span>
<span class="comments">; RESTORE CAL FILES AND STORE </span>
<span class="comments">; THE DATA  </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: STARTING LOOP ON ALL CAL-SENSOR FILES'
  FOR I=0,NUM_CAL_CONFIGS-1 DO BEGIN

<span class="comments">;-------------------------------- </span>
<span class="comments">; GET SENSOR CONFIGURATION FROM FILENAME</span>

    POS   = STRPOS(CAL_FILES[I],VA_REGION,/REVERSE_SEARCH)+STRLEN(VA_REGION)+1
    POS1  = STRPOS(CAL_FILES[I],REF_SENSOR,/REVERSE_SEARCH)-1
    TMP   = STRMID(CAL_FILES[I],POS,POS1-POS)
    SENSOR_CONFIGS = [SENSOR_CONFIGS,TMP]
    RESTORE,CAL_FILES[I] 
   
    TEMP_ELEMENTS = N_ELEMENTS(ED_SENSOR2_SENSOR1[0,*])
    FOR J=0,4 DO ANGL_DATA[0:TEMP_ELEMENTS-1,I+1,J] = DOUBLE(ED_SENSOR2_SENSOR1[J,*])
  ENDFOR
  
<span class="comments">;--------------------------------</span>
<span class="comments">; RETURN ALL DATA IN A STRUCTURE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_ANGL: RETURNING ANGLES DATA STRUCTURE'

  VISU_ANGL = {                                             $
              ERROR:0                                       ,$
              DATA:ANGL_DATA                                ,$
              NUM_SENS_CONFIGS:NUM_SENS_CONFIGS             ,$
              SENSOR_CONFIGS:SENSOR_CONFIGS                 ,$
              SENS_CONFIG_ABLE:SENS_CONFIG_ABLE             $
              }

  RETURN,VISU_ANGL

END
</code>
    </div>
  </body>
</html>