<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:44 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cloud_module_globcarbon_p.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cloud_module_globcarbon_p.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      CLOUD_MODULE_GLOBCARBON_P       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS FUNCTION PERFORMS THE CLOUDSCREENING ALGORITHM DEVELOPED FOR THE GLOBCARBON </span>
<span class="comments">;*      PROJECT. THE ALGORITHM PERFORMS 2 CLOUD SCREENING PASSES ON PIXELS FLAGGED AS </span>
<span class="comments">;*      "BRIGHT" BY THE OPERATIONAL MERIS BRIGHT PIXEL FLAG ALGORITHM. THIS ALGORITHM </span>
<span class="comments">;*      HAS BEEN MODIFIED TO WORK USING FIXED THRESHOLDS AND WAVEBAND AVAILABLE TO PARASOL</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = CLOUD_MODULE_GLOBCARBON_P(SITE_TYPE,GCARBON_REF,TOA_GEO)    </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      SITE_TYPE  - A STRING OF THE DIMITRI VALIDATION SITE TYPE (E.G. 'OCEANIC')'</span>
<span class="comments">;*      GCARBON_REF- A FLOAT ARRAY CONTAINING THE TOA REFLECTANCE AT 443,705,750 AND </span>
<span class="comments">;*                   865NM [NB_PIXELS,RHO_BANDS]</span>
<span class="comments">;*      TOA_GEO    - A 3 OR 4 ELEMENT ARRAY CONTAINING THE SZA AND VZA VALUES AND EITHER</span>
<span class="comments">;*                   RAA OR SAA AND VAA </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE    - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      CLASS_PIXELS - AN INTEGER ARRAY OF SIXE NUMBER OF PIXELS, 0 MEANS CLEAR PIXEL, </span>
<span class="comments">;*                     1 MEANS CLOUDY</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      14 MAY 2011 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*      14 MAY 2011 - C KENT   - ADDED BAND INDEX VALUES</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      14 MAY 2011 - C KENT   - NOMINAL COMPILATION AND OPERATION ON WINDOWS 32BIT </span>
<span class="comments">;*                               IDL 7.1 AND LINUX 64BIT IDL 8.0 </span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION CLOUD_MODULE_GLOBCARBON_P,SITE_TYPE,GCARBON_REF,TOA_GEO,VERBOSE=VERBOSE

<span class="comments">;-------------------------</span>
<span class="comments">; RESTORE BRIGHT LUT INFORMATION</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: RESTORING BRIGHT LUT INFORMATION'
  TEMP_LUT = GET_DIMITRI_LOCATION('BRIGHT_LUT')
  RESTORE,TEMP_LUT

<span class="comments">;-------------------------</span>
<span class="comments">; DEFINE SNOW AND CLOUD THRESHOLDS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: DEFINING THRESHOLDS AND PARAMETERS'
  SNOW_THRESH   = 0.9386
  CLOUD_THRESH  = 1.736

<span class="comments">;-------------------------</span>
<span class="comments">; DEFINE PARAMETERS FOR CLOUD SCREENING</span>

  TEMP_DIMS     = SIZE(GCARBON_REF,/DIMENSIONS)
  NB_PIXELS     = TEMP_DIMS[0]
  BRIGHT_PIXELS = INTARR(NB_PIXELS)
  CLASS_PIXELS  = INTARR(NB_PIXELS)

  ICLEAR  = 0
  ICLOUD  = 1
  ISNOW   = 2
  IBRIGHT = 3
  
  B1 = 0
  B2 = 1
  B3 = 2
  B4 = 3

<span class="comments">;-------------------------</span>
<span class="comments">; FOR EACH PIXEL FIND OUT IF IT'S "BRIGHT"</span>

  FOR GCI=0L,NB_PIXELS-1 DO BRIGHT_PIXELS[GCI] = DIMITRI_CLOUD_SCREENING_BRIGHT_RHO(GCARBON_REF[GCI,B1],TOA_GEO[GCI,*],BRIGHT_RHO)

<span class="comments">;-------------------------</span>
<span class="comments">; IF NO BRIGHT PIXELS THEN RETURN ALL PIXELS AS CLEAR</span>

  BRIGHTF = WHERE(BRIGHT_PIXELS EQ 1)
  IF BRIGHTF[0] EQ -1 THEN RETURN,CLASS_PIXELS
  
<span class="comments">;-------------------------</span>
<span class="comments">; IF OCEANIC SITE THEN BRIGHT PIXELS ARE CLOUD</span>

  IF SITE_TYPE EQ 'OCEANIC' THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: OCEANIC EXCEPTION, BRIGHT PIXELS ARE CLOUD'
    CLASS_PIXELS[BRIGHTF] = ICLOUD
    RETURN,CLASS_PIXELS
  ENDIF ELSE CLASS_PIXELS[BRIGHTF] =  IBRIGHT

<span class="comments">;-------------------------</span>
<span class="comments">; PASS 1: PERFORM RATIO OF B9/B13 </span>
<span class="comments">; TO DEFINE EITHER SNOW OR CLOUD PIXELS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: PERFORMING PASS 1'
  PASS_1 = GCARBON_REF[*,B2]/GCARBON_REF[*,B4]
  SNOWF = WHERE(PASS_1 GT SNOW_THRESH AND CLASS_PIXELS EQ IBRIGHT)
  IF SNOWF[0] GT -1 THEN CLASS_PIXELS[SNOWF] = ISNOW 

<span class="comments">;-------------------------</span>
<span class="comments">; PASS 2: OF PIXELS FLAGGED AS </span>
<span class="comments">; CLOUD USE B2/B10 TO DETERMINE CLOUD OR BRIGHT LAND</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: PERFORMING PASS 2'
  PASS_2 = GCARBON_REF[*,B1]/GCARBON_REF[*,B3]
  CLOUDF = WHERE(PASS_2 GT CLOUD_THRESH AND CLASS_PIXELS NE ISNOW AND CLASS_PIXELS EQ IBRIGHT)
  IF CLOUDF[0] GT -1 THEN CLASS_PIXELS[CLOUDF] = ICLOUD 

<span class="comments">;-------------------------</span>
<span class="comments">; COMPUTE STATS FOR PRODUCT</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'CLOUD_MODULE_GLOBCARBON_P: COMPUTING STATS'
  STATS_SNOW  = 100*FLOAT(N_ELEMENTS(SNOWF))/FLOAT(NB_PIXELS)
  STATS_CLOUD = 100*FLOAT(N_ELEMENTS(cloudF))/FLOAT(NB_PIXELS)
  STATS_CLEAR = 100.0-STATS_SNOW-STATS_CLOUD
 
  IF KEYWORD_SET(VERBOSE) THEN PRINT,$
    'CLOUD_MODULE_GLOBCARBON_P: SNOW: ',STATS_SNOW,' CLOUD: ',STATS_CLOUD,' CLEAR: ',STATS_CLEAR

<span class="comments">;-------------------------</span>
<span class="comments">; RESET ALL SNOW PIXELS AS CLEAR</span>

  IF SNOWF[0] GT -1 THEN CLASS_PIXELS[SNOWF] = ICLEAR

<span class="comments">;-------------------------</span>
<span class="comments">; RESET ALL BRIGHT PIXELS AS CLEAR</span>
  
  RES = WHERE(CLASS_PIXELS EQ IBRIGHT)
  IF RES[0] GT -1 THEN CLASS_PIXELS[RES] = ICLEAR  
    
  RETURN,CLASS_PIXELS

END
</code>
    </div>
  </body>
</html>