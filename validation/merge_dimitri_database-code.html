<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:56 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>merge_dimitri_database.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="merge_dimitri_database.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO MERGE_DIMITRI_DATABASE

<span class="comments">; THIS PROGRAM LOADS TWO DIMITRI DATABASE FILE </span>
<span class="comments">; AND TRANSFERS THE MANUAL CLOUD SCREENING </span>
<span class="comments">; FROM ONE VERSION TO THE OTHER</span>

<span class="comments">; NOTE, PLEASE RUN THE @COMPILE_DIMITRI COMMAND </span>
<span class="comments">; IN THE DIMITRI FOLDER LOCATION OF DATABASE2 </span>
<span class="comments">; (THE ONE TO BE UPDATED) AND STAY IN THE SOURCE DIRECTORY</span>

<span class="comments">; DEFINE BOTH DATABASE FILES</span>

<span class="comments">;  DB1_FILE = 'C:\Documents and Settings\Christopher\Desktop\db_copy_11_August_2011\DIMITRI_DATABASE.CSV'</span>
<span class="comments">;  DB2_FILE = 'C:\Documents and Settings\Christopher\Desktop\db_copy_11_August_2011\ 1_Aug_2011_DIMITRI_DATABASE.CSV'</span>

  restore,'./validation/db1_data_new_format_20120410.sav'


<span class="comments">; READ IN BOTH DATABASES</span>

  DB_TEMPLATE  = GET_DIMITRI_TEMPLATE(1,/TEMPLATE,VERBOSE=VERBOSE)
 <span class="comments">; DB1_DATA     = READ_ASCII(DB1_FILE,TEMPLATE=DB_TEMPLATE)</span>
  DB2_DATA     = READ_ASCII(get_dimitri_location('DATABASE'),TEMPLATE=DB_TEMPLATE)
  COUNTER      = 0l

<span class="comments">; FIND INDEX OF ALL CHANGES TO MANUAL CS IN DB1</span>

  CHID = WHERE(DB1_DATA.MANUAL_CS NE -1 and DB1_DATA.sensor eq 'VEGETATION', COUNT)
  IF COUNT EQ 0 THEN GOTO, NO_CHANGE

<span class="comments">; LOOP OVER EACH INDEX VALUE</span>

  FOR II=0L,COUNT-1 DO BEGIN
  print, ii, ' out of ',count-1 

   <span class="comments">; if ii mod count/10. eq 0 then print, string(string(float(ii)/float(count),format='(i3)')+'% complete...')</span>

    MATCH = WHERE(DB2_DATA.FILENAME EQ DB1_DATA.FILENAME[CHID[II]]  AND $
                  DB2_DATA.REGION EQ DB1_DATA.REGION[CHID[II]]      AND $
                  DB2_DATA.SENSOR EQ DB1_DATA.SENSOR[CHID[II]]      AND $
                  DB2_DATA.PROCESSING_VERSION EQ DB1_DATA.PROCESSING_VERSION[CHID[II]],MCOUNT)
  
    IF MCOUNT EQ 0 THEN CONTINUE
    IF MCOUNT GT 1 THEN BEGIN
      PRINT, 'ERROR FOUND TWO MATCHES FOR FILENAME: ',DB2_DATA.FILENAME[CHID[II]]
      CONTINUE
    ENDIF

<span class="comments">; CHANGE DB2 VALUE</span>
  
    DB2_DATA.MANUAL_CS[MATCH] = DB1_DATA.MANUAL_CS[CHID[II]]
    COUNTER++

<span class="comments">; END LOOP</span>
  
  ENDFOR

<span class="comments">;SAVE DB2</span>
  
  RES = SAVE_DIMITRI_DATABASE(DB2_DATA)
  NO_CHANGE:
  PRINT, COUNTER, ' CHANGES MADE'

END
</code>
    </div>
  </body>
</html>